<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr auto;
  background: #000;
  color: #0f0;
  font-family: monospace;
  height: 100%;
  width: 100%;
  position: absolute;
  margin: 0;
  font-size: 1.2rem;
  padding: 3em;
  top: 0;
  left: 0;
}
#shell-output {
  overflow-x: clip;
  overflow-y: auto;
  white-space: normal;
  word-wrap: anywhere;
}
.active::after {
  content: '|';
  animation: active linear alternate infinite 1s;
  color: #fff;
}

@keyframes active {
  0% {
    opacity: 1;
  }
  80% {
    opacity: 1;
  }
  81% {
    opacity: 0;
  }
  100% {
    opacity: 0;
  }
}
* {
  box-sizing: border-box;
}
</style>
  </head>
  <body>
    <pre id="shell-output"></pre>
    <input type="text" id="shell-input" placeholder="Type here (enter to send)"/>
    <script>
const input = document.getElementById('shell-input');
const output = document.getElementById('shell-output');
function w(t) {
  output.appendChild(document.createTextNode(t));
  output.scrollTop = output.scrollHeight;
}

const wsURL = new URL('/shell', location.href);
wsURL.protocol = 'ws:';
const ws = new WebSocket(wsURL);

ws.addEventListener('message', function(ev) {
  w(ev.data);
});

ws.addEventListener('close', function() {
  w('Connection closed...');
  input.disabled = true;
});

input.addEventListener('keydown', function(ev) {
  if (ev.keyCode === 13) {
    ws.send(input.value+'\n');
    w(input.value+'\n');
    input.value = '';
  }
});
input.addEventListener('compositionupdate', function(ev) {
  if (ev.data.includes('\n')) {
    ws.send(input.value);
    w(input.value);
    input.value = '';
  }
});
    </script>
  </body>
</html>
